---
phase: 06-strategy-intake-upgrade
plan: 03
type: execute
wave: 3
depends_on: ["06-02"]
files_modified:
  - src/components/strategy/StrategyIntake.tsx
autonomous: true

must_haves:
  truths:
    - "Results panel shows confidence score (numeric, labeled)"
    - "Results panel shows signal chips for each detectedSignalKey"
    - "Results panel shows stakeholdersClarityLevel as a labeled indicator"
    - "Results panel shows campaign stack section (ordered list)"
    - "Results panel shows a Why section combining cadenceRationale and up to 3 evidence highlights"
    - "Results panel shows separate notes for requiresVisibilityArchive and requiresApprovalWorkflow"
    - "All existing sections (Summary, Cadence, Channels, Assets, Experiments, Risks, Next Steps, Planner Prompt) remain intact"
    - "No TypeScript errors"
  artifacts:
    - path: "src/components/strategy/StrategyIntake.tsx"
      provides: "Updated results panel with all new UI fields"
      contains: "confidenceScore"
    - path: "src/components/strategy/StrategyIntake.tsx"
      provides: "Signal chips section"
      contains: "detectedSignalKeys"
  key_links:
    - from: "StrategyIntake component"
      to: "StrategyRecommendation"
      via: "state from useFormState"
      pattern: "state\\.confidenceScore"
---

<objective>
Update src/components/strategy/StrategyIntake.tsx to surface all new fields from StrategyRecommendation in the results panel (Item 6). No structural changes to the form or existing result sections — additive inserts only.

Purpose: Users need to see confidence, signals, clarity, stack, and compliance distinction in the UI. This plan makes those visible.
Output: Updated StrategyIntake.tsx with all new display sections inserted in the results panel.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/06-strategy-intake-upgrade/06-02-SUMMARY.md
@src/components/strategy/StrategyIntake.tsx
@src/app/actions/strategy.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add signal chips, confidence indicator, and stakeholders clarity indicator (Item 6 — top of results)</name>
  <files>src/components/strategy/StrategyIntake.tsx</files>
  <action>
Make ADDITIVE inserts only. Do NOT touch the form section or any existing result section.

The current results panel has this structure inside `{state && (...)}`:
1. Summary
2. Cadence
3. Channels
4. Assets
5. Experiments
6. Risks & Notes (conditional)
7. Next Steps
8. Planner Prompt

INSERT the following three new sections immediately AFTER the Summary div and BEFORE the Cadence div. Preserve all indentation and className patterns consistent with existing sections.

SECTION A — Signal chips (detectedSignalKeys):
```tsx
<div>
  <div className="font-semibold text-gray-900">Signals Detected</div>
  <div className="mt-1 flex flex-wrap gap-1">
    {state.detectedSignalKeys.map((key) => (
      <span
        key={key}
        className="rounded-full bg-blue-50 px-2 py-0.5 text-xs font-medium text-blue-700 border border-blue-200"
      >
        {key}
      </span>
    ))}
    {state.detectedSignalKeys.length === 0 && (
      <span className="text-gray-400 text-xs">No specific signals detected</span>
    )}
  </div>
</div>
```

SECTION B — Confidence indicator:
```tsx
<div>
  <div className="font-semibold text-gray-900">Confidence Score</div>
  <div className="mt-1 flex items-center gap-2">
    <div className="h-2 w-32 rounded-full bg-gray-200">
      <div
        className="h-2 rounded-full bg-blue-500"
        style={{ width: `${state.confidenceScore}%` }}
      />
    </div>
    <span className="text-xs text-gray-600">{state.confidenceScore}/100</span>
  </div>
</div>
```

SECTION C — Stakeholders clarity indicator:
```tsx
<div>
  <div className="font-semibold text-gray-900">Audience Clarity</div>
  <div className="mt-1 flex items-center gap-2">
    <span
      className={
        state.stakeholdersClarityLevel === "high"
          ? "rounded-full bg-green-50 px-2 py-0.5 text-xs font-medium text-green-700 border border-green-200"
          : state.stakeholdersClarityLevel === "medium"
            ? "rounded-full bg-yellow-50 px-2 py-0.5 text-xs font-medium text-yellow-700 border border-yellow-200"
            : "rounded-full bg-red-50 px-2 py-0.5 text-xs font-medium text-red-700 border border-red-200"
      }
    >
      {state.stakeholdersClarityLevel}
    </span>
    <span className="text-xs text-gray-500">
      {state.stakeholdersClarityLevel === "high"
        ? "Audience well-defined"
        : state.stakeholdersClarityLevel === "medium"
          ? "Audience partially defined"
          : "Audience unclear — review MIQ-01"}
    </span>
  </div>
</div>
```

These three divs go between Summary and Cadence.
  </action>
  <verify>
Run: npx tsc --noEmit — no errors.
Visual: Submit an intake with "We are launching a new IOP for referring physicians" and confirm:
- Signal chips show (at minimum): "launch", "referral-enablement"
- Confidence score bar renders with a non-zero width
- Audience clarity shows "high" (green) chip
  </verify>
  <done>
Signal chips, confidence bar, and clarity indicator appear between Summary and Cadence in the results panel without breaking existing sections.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add campaign stack, Why section, compliance notes (Items 4, 6 — middle/bottom of results)</name>
  <files>src/components/strategy/StrategyIntake.tsx</files>
  <action>
Make three more ADDITIVE inserts. Do not change existing sections.

INSERT LOCATION 1 — Campaign Stack section.
Place AFTER the Channels div and BEFORE the Assets div:

```tsx
<div>
  <div className="font-semibold text-gray-900">Campaign Stack</div>
  <ol className="mt-1 list-decimal pl-4 space-y-0.5">
    {state.stack.map((item, i) => (
      <li key={i}>{item}</li>
    ))}
  </ol>
</div>
```

INSERT LOCATION 2 — Why section (cadenceRationale + evidence highlights).
Place AFTER the Cadence div and BEFORE the Channels div (so the flow is: Cadence → Why → Channels → Campaign Stack → Assets):

```tsx
<div>
  <div className="font-semibold text-gray-900">Why This Cadence</div>
  <p className="mt-1 text-gray-700">{state.cadenceRationale}</p>
  {Object.keys(state.evidence).length > 0 && (
    <div className="mt-2">
      <div className="text-xs font-medium text-gray-500 uppercase tracking-wide">Evidence highlights</div>
      <ul className="mt-1 space-y-0.5">
        {Object.entries(state.evidence)
          .filter(([, terms]) => terms && terms.length > 0)
          .slice(0, 3)
          .map(([key, terms]) => (
            <li key={key} className="text-xs text-gray-600">
              <span className="font-medium">{key}:</span>{" "}
              {(terms as string[]).slice(0, 3).join(", ")}
            </li>
          ))}
      </ul>
    </div>
  )}
</div>
```

INSERT LOCATION 3 — Replace/update the Risks & Notes section.
Currently the Risks & Notes section is:
```tsx
{state.risks.length > 0 && (
  <div>
    <div className="font-semibold text-gray-900">Risks & Notes</div>
    <ul className="mt-1 list-disc pl-4">
      {state.risks.map((risk) => (
        <li key={risk}>{risk}</li>
      ))}
    </ul>
  </div>
)}
```

Replace it with the following block that KEEPS the risks list AND adds separate compliance flag notes BELOW it:
```tsx
{(state.risks.length > 0 || state.requiresVisibilityArchive || state.requiresApprovalWorkflow) && (
  <div>
    <div className="font-semibold text-gray-900">Risks & Notes</div>
    {state.risks.length > 0 && (
      <ul className="mt-1 list-disc pl-4">
        {state.risks.map((risk) => (
          <li key={risk}>{risk}</li>
        ))}
      </ul>
    )}
    {state.requiresVisibilityArchive && (
      <div className="mt-2 rounded-md bg-amber-50 border border-amber-200 px-3 py-2 text-xs text-amber-800">
        <span className="font-semibold">Archive / Visibility required:</span> Compliance or reporting signals detected. Content related to compliance, annual reports, or stakeholder visibility should be archived and documented.
      </div>
    )}
    {state.requiresApprovalWorkflow && (
      <div className="mt-2 rounded-md bg-orange-50 border border-orange-200 px-3 py-2 text-xs text-orange-800">
        <span className="font-semibold">Approval gates required:</span> Explicit approval or sign-off language detected. All deliverables must pass a documented approval checkpoint before publish.
      </div>
    )}
  </div>
)}
```

FINAL SECTION ORDER in results panel after all edits:
1. Summary
2. Signals Detected (chip row)
3. Confidence Score (bar)
4. Audience Clarity (chip + label)
5. Cadence (unchanged)
6. Why This Cadence (rationale + evidence)
7. Channels (unchanged)
8. Campaign Stack (new ordered list)
9. Assets (unchanged)
10. Experiments (unchanged)
11. Risks & Notes (updated — includes compliance flag notes)
12. Next Steps (unchanged)
13. Planner Prompt (unchanged)

Do NOT add missingInfoQuestions section — it is already surfaced via nextSteps. Keep it that way.
  </action>
  <verify>
Run: npx tsc --noEmit — no errors.
Visual checks:
1. Submit intake: "We want to produce an annual report demonstrating compliance for our board" — verify:
   - requiresVisibilityArchive amber banner appears
   - requiresApprovalWorkflow orange banner does NOT appear
2. Submit intake: "All content review required before publish; approval required" — verify:
   - requiresApprovalWorkflow orange banner appears
3. Submit intake with launch + referral keywords — verify:
   - Campaign Stack section shows 4+ items
   - Why This Cadence has evidence highlights from matched terms
  </verify>
  <done>
All new UI sections render without breaking existing layout. Compliance flags are visually distinct (amber vs orange). Campaign stack appears as ordered list. Why section shows cadenceRationale + up to 3 evidence highlights.
  </done>
</task>

</tasks>

<verification>
Run `npx tsc --noEmit` — zero errors.
Load the strategy page and submit three test intakes:
1. "We are launching a new outpatient mental health program targeting referring physicians and providers. We need to demonstrate compliance for our annual board report."
   - Expected: high clarity, signals include launch + referral-enablement + compliance-visibility, amber archive banner visible, campaign stack shows program-launch items
2. "General awareness campaign. Approval required from compliance officer before all sends."
   - Expected: low clarity, approval gate orange banner visible, amber archive NOT visible (no compliance-visibility signal unless compliance matched)
3. "We want to build community trust and reduce stigma around mental health. Our audience is families and adults in the community."
   - Expected: medium/high clarity, trust-building archetype, stack shows weekly anchor / newsletter / educational clusters
</verification>

<success_criteria>
- npx tsc --noEmit exits 0
- All 13 result sections render in correct order
- Signal chips show for detected signals
- Confidence bar renders (width proportional to score)
- Clarity chip is color-coded (green/yellow/red)
- Campaign stack renders as ordered list with 3–6 items
- Why section shows cadenceRationale and up to 3 evidence entries
- Archive and approval notes appear separately and only when true
- No existing sections broken or removed
</success_criteria>

<output>
After completion, create `.planning/phases/06-strategy-intake-upgrade/06-03-SUMMARY.md`
</output>
