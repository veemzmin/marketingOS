---
phase: 03-content-creation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - prisma/schema.prisma
  - package.json
autonomous: true

must_haves:
  truths:
    - "Database stores content with versioning for audit trail"
    - "Content has status workflow (DRAFT, SUBMITTED, IN_REVIEW, APPROVED, REJECTED)"
    - "Every content change creates new immutable version record"
  artifacts:
    - path: "prisma/schema.prisma"
      provides: "Content, ContentVersion, ReviewDecision models"
      contains: "model Content"
    - path: "node_modules/react-hook-form"
      provides: "Form validation library"
      min_lines: 1
    - path: "node_modules/zod"
      provides: "Schema validation library"
      min_lines: 1
  key_links:
    - from: "Content model"
      to: "Organization model"
      via: "organizationId foreign key"
      pattern: "organizationId.*@relation"
    - from: "ContentVersion model"
      to: "Content model"
      via: "contentId foreign key"
      pattern: "contentId.*@relation"
---

<objective>
Establish database schema and dependencies for content creation system.

Purpose: Provide data models for content drafts, versioning, and status workflow, plus install validation libraries required for forms.

Output: Prisma schema with Content/ContentVersion/ReviewDecision models, npm packages installed, database migrated.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-content-creation/03-RESEARCH.md
@prisma/schema.prisma
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Content schema with versioning and status workflow</name>
  <files>prisma/schema.prisma</files>
  <action>
Add Content models to schema.prisma following the immutable versioning pattern from research:

1. **ContentStatus enum** with states: DRAFT, SUBMITTED, IN_REVIEW, APPROVED, REJECTED

2. **Content model** with fields:
   - id (String @id @default(cuid()))
   - organizationId (String, FK to Organization)
   - title (String)
   - status (ContentStatus @default(DRAFT))
   - complianceScore (Int? - nullable, latest score)
   - createdByUserId (String, FK to User)
   - createdAt/updatedAt (DateTime)
   - Relationships: organization, createdBy (User), versions (ContentVersion[]), reviewDecision (ReviewDecision?)
   - Indexes: organizationId, status, createdByUserId
   - Map: "content"

3. **ContentVersion model** (immutable audit trail):
   - id (String @id @default(cuid()))
   - contentId (String, FK to Content)
   - versionNumber (Int)
   - title (String)
   - body (String @db.Text - large text field)
   - topic (String - from research: mental-health, substance-use, wellness, crisis)
   - audience (String - from research: patients, families, professionals, general)
   - tone (String - from research: informative, supportive, clinical, motivational)
   - complianceScore (Int - score at time of version creation)
   - createdByUserId (String, FK to User)
   - createdAt (DateTime @default(now()))
   - Unique constraint: [contentId, versionNumber]
   - Indexes: contentId, createdByUserId
   - Map: "content_versions"

4. **ReviewDecision model** (Phase 4 will use, define now):
   - id (String @id @default(cuid()))
   - contentId (String @unique, FK to Content)
   - decision (String - APPROVED or REJECTED)
   - reviewedByUserId (String, FK to User)
   - reason (String? - nullable, for rejections)
   - createdAt (DateTime @default(now()))
   - Indexes: contentId, reviewedByUserId
   - Map: "review_decisions"

5. Update User model to add relation fields:
   - Add: contentCreated Content[] (relation from Content.createdByUserId)
   - Add: contentVersions ContentVersion[] (relation from ContentVersion.createdByUserId)
   - Add: reviewDecisions ReviewDecision[] (relation from ReviewDecision.reviewedByUserId)

Follow existing schema conventions (@@map, indexes, RLS-compatible structure).

After adding models, generate Prisma client and create migration:
```bash
npx prisma generate
npx prisma migrate dev --name add_content_models
```
  </action>
  <verify>
Schema file contains Content, ContentVersion, ReviewDecision models.
Database migration applied successfully (check with `npx prisma migrate status`).
  </verify>
  <done>
Content models exist in schema.prisma with proper relationships, indexes, and RLS compatibility.
Database reflects new schema (content, content_versions, review_decisions tables exist).
  </done>
</task>

<task type="auto">
  <name>Task 2: Install form validation dependencies</name>
  <files>package.json</files>
  <action>
Install React Hook Form and Zod for content editor forms (identified in research as standard stack):

```bash
npm install react-hook-form zod @hookform/resolvers
```

Optional but recommended (improves UX):
```bash
npm install react-hot-toast
```

Verify installation:
```bash
npm list react-hook-form zod @hookform/resolvers
```

Do NOT install use-debounce (research shows manual useEffect with setTimeout is preferred for full control).
  </action>
  <verify>
package.json contains react-hook-form, zod, @hookform/resolvers.
node_modules directories exist for these packages.
`npm list react-hook-form` shows installed version.
  </verify>
  <done>
Form validation libraries installed and ready for use in content editor (Plan 03-03).
  </done>
</task>

</tasks>

<verification>
1. Prisma schema includes Content, ContentVersion, ReviewDecision models
2. ContentStatus enum defines DRAFT → SUBMITTED → IN_REVIEW → APPROVED/REJECTED workflow
3. ContentVersion uses immutable versioning (unique [contentId, versionNumber])
4. All models have proper foreign keys to Organization and User (multi-tenant RLS compatible)
5. react-hook-form, zod, @hookform/resolvers installed in package.json
6. Database migration applied successfully
</verification>

<success_criteria>
- Content models exist with status workflow and versioning
- Database schema supports immutable audit trail (append-only versions)
- Form validation libraries available for editor implementation
- Multi-tenant isolation enforced via organizationId foreign keys
</success_criteria>

<output>
After completion, create `.planning/phases/03-content-creation/03-01-SUMMARY.md`
</output>
